---
title: "Assignment 1_Beining Niu & Wenyi Wang"
subtitle: "Due at 11:59pm on September 16."
format: pdf 
editor: visual
---

This assignment is to be submitted individually. Turn in this assignment as an HTML or PDF file to ELMS. Make sure to include the R Markdown or Quarto file that was used to generate it. You should include the questions in your solutions. You may use the qmd file of the assignment provided to insert your answers.

## Git and GitHub

1\) Provide the link to the GitHub repo that you used to practice git from Week 1. It should have:

-   Your name on the README file.

-   At least one commit with your name, with a description of what you did in that commit.

## Reading Data

Download both the Angell.dta (Stata data format) dataset and the Angell.txt dataset from this website: <https://stats.idre.ucla.edu/stata/examples/ara/applied-regression-analysis-by-fox-data-files/>

2\) Read in the .dta version and store in an object called `angell_stata`.

```{r}
library("haven")
library("ggplot2")
```

```{r}
angell_stata <- read_dta('/Users/wyi/Desktop/Fall 2025/SURVMETH 727/Niu-Wang-a1/angell.dta')
angell_stata
```

3\) Read in the .txt version and store it in an object called `angell_txt`.

```{r}
angell_txt <- read.table('/Users/wyi/Desktop/Fall 2025/SURVMETH 727/Niu-Wang-a1/angell.txt')
angell_txt
```

4\) What are the differences between `angell_stata` and `angell_txt`? Are there differences in the classes of the individual columns?

There are no column names in angell_txt, while column names are saved in angell_stata. Classes of the individual columns are the same in angell_stata and angell_txt.

5\) Make any updates necessary so that `angell_txt` is the same as `angell_stata`.

```{r}
colnames(angell_txt) <- c("city", "morint", "ethhet", "geomob", "region")
angell_txt
```

6\) Describe the Ethnic Heterogeneity variable. Use descriptive statistics such as mean, median, standard deviation, etc. How does it differ by region?

```{r}
summary(angell_stata$ethhet)
sd(angell_stata$ethhet)
ggplot(angell_stata, aes(x = ethhet)) +
  geom_histogram(binwidth = 5,
                 color = "white") +
  labs(x = "Ethnic Heterogeneity", y = "Percentage")
```

For the variable of Ethnic Heterogeneity, the range is between 10.60 and 84.50. The mean is 31.37 and the median is 23.70, suggesting a positively skewed distribution (also shown in the histogram). The standard deviation is about 20.41, indicating the percentages of nonwhite and foreign-born white residents greatly vary around the mean across these 43 cities.

```{r}
summary(angell_stata$region)
sd(angell_stata$region)

tapply(angell_stata$ethhet, angell_stata$region, summary)
tapply(angell_stata$ethhet, angell_stata$region, sd, na.rm = TRUE)

ggplot(angell_stata, aes(x = region, y = ethhet)) +
  geom_boxplot()+
  labs(x = "Region", y = "Ethnic Heterogeneity")
```

According to the descriptive statistics and boxplot, the Southeast shows the highest mean of 52.49 and median of 53.80 in Ethnic Heterogeneity among these regions, which means, on average, the Southeast has the highest percentage of nonwhite and foreign-born white residents when compared to the Northeast, the Midwest, and the West. In addition, the Southeast also has the highest standard deviation (SD = 21.44) among regions, indicating the percentage of nonwhite and foreign-born white residents has highest variation across cities in the Southeast, when compared to the variation of Ethnic Heterogeneity of cities in their corresponding regions.

## Describing Data

R comes also with many built-in datasets. The "MASS" package, for example, comes with the "Boston" dataset.

7\) Install the "MASS" package, load the package. Then, load the Boston dataset.

```{r}
install.packages("MASS")     
library(MASS)
data("Boston")              
```

8\) What is the type of the Boston object?

```{r}
typeof(Boston)
```

9\) What is the class of the Boston object?

```{r}
class(Boston)
```

10\) How many of the suburbs in the Boston data set bound the Charles river?

```{r}
sum(Boston$chas == 1, na.rm = TRUE)
```

11\) Do any of the suburbs of Boston appear to have particularly high crime rates? Tax rates? Pupil-teacher ratios? Comment on the range of each variable.

```{r}
crim_min  <- min(Boston$crim)
crim_max  <- max(Boston$crim)
crim_p95  <- quantile(Boston$crim, 0.95)
crim_n95  <- sum(Boston$crim > crim_p95)

tax_min   <- min(Boston$tax)
tax_max   <- max(Boston$tax)
tax_p95   <- quantile(Boston$tax, 0.95)
tax_n95   <- sum(Boston$tax > tax_p95)

ptr_min   <- min(Boston$ptratio)
ptr_max   <- max(Boston$ptratio)
ptr_p95   <- quantile(Boston$ptratio, 0.95)
ptr_n95   <- sum(Boston$ptratio > ptr_p95)

cat(
  "The crime rate ranges from", crim_min, "to", crim_max, "with", crim_n95, "suburbs above the 95th percentile of", paste0(crim_p95,"."),
  
  "The tax rate ranges from", tax_min, "to", tax_max, "with", tax_n95, "suburbs above the 95th percentile of", paste0(tax_p95, "."),
  
  "The pupil–teacher ratio ranges from", ptr_min, "to", ptr_max, "with", ptr_n95, "suburbs above the 95th percentile of", paste0(ptr_p95,".")
)


```

12\) Describe the distribution of pupil-teacher ratio among the towns in this data set that have a per capita crime rate larger than 1. How does it differ from towns that have a per capita crime rate smaller than 1?

```{r}
high_crime <- Boston$ptratio[Boston$crim > 1]
low_crime  <- Boston$ptratio[Boston$crim <= 1]

mean(high_crime)
median(high_crime)
sd(high_crime)
min(high_crime)
max(high_crime)

mean(low_crime)
median(low_crime)
sd(low_crime)
min(low_crime)
max(low_crime)
```

For towns with per capita crime rate greater than 1, the pupil–teacher ratio has a mean of 19.29, a median of 20.2, a standard deviation of 2.12, and ranges from 14.7 to 21.2. In contrast, for towns with crime rate less than or equal to 1, the mean is 18.02, the median is 18.3, the standard deviation is 2.06, and the range is 12.6 to 22. Overall, towns with higher crime rates tend to have slightly larger pupil–teacher ratios, while towns with lower crime rates show a wider spread and include the lowest ratios in the dataset.

## Writing Functions

13\) Write a function that calculates 95% confidence intervals for a point estimate. The function should be called `my_CI`. When called with `my_CI(2, 0.2)`, the function should print out "The 95% CI upper bound of point estimate 2 with standard error 0.2 is 2.392. The lower bound is 1.608."

*Note: The function should take a point estimate and its standard error as arguments. You may use the formula for 95% CI: point estimate +/- 1.96\*standard error.*

*Hint: Pasting text in R can be done with:* `paste()` *and* `paste0()`

```{r}
my_CI <- function(estimate, se) {
  lower <- estimate - 1.96 * se
  upper <- estimate + 1.96 * se
  
  message <- paste0(
    "The 95% CI upper bound of point estimate ", estimate,
    " with standard error ", se, " is ", round(upper, 3),
    ". The lower bound is ", round(lower, 3), "."
  )
  cat(message, "\n")
}

my_CI(2, 0.2)
```

14\) Create a new function called `my_CI2` that does that same thing as the `my_CI` function but outputs a vector of length 2 with the lower and upper bound of the confidence interval instead of printing out the text. Use this to find the 95% confidence interval for a point estimate of 0 and standard error 0.4.

```{r}
my_CI2 <- function(estimate, se) {
  lower <- estimate - 1.96 * se
  upper <- estimate + 1.96 * se
  return(paste0("(", round(lower, 3), ", ", round(upper, 3), ")"))
}

my_CI2(0, 0.4)
```

15\) Update the `my_CI2` function to take any confidence level instead of only 95%. Call the new function `my_CI3`. You should add an argument to your function for confidence level.

*Hint: Use the* `qnorm` *function to find the appropriate z-value. For example, for a 95% confidence interval, using* `qnorm(0.975)` *gives approximately 1.96.*

```{r}
my_CI3 <- function(estimate, se, conf_level = 0.95) {
  
  if(conf_level <= 0 || conf_level >= 1) {
    stop("Confidence level must be between 0 and 1.")
  }
  
  z <- qnorm((1 + conf_level) / 2)
  lower <- estimate - z * se
  upper <- estimate + z * se
  
  return(paste0("(", round(lower, 3), ", ", round(upper, 3), ")"))
}

my_CI3(2, 0.2, conf_level = 0.95) 
my_CI3(2, 0.2, conf_level = 0.9)
```

16\) Without hardcoding any numbers in the code, find a 99% confidence interval for Ethnic Heterogeneity in the Angell dataset. Find the standard error by dividing the standard deviation by the square root of the sample size.

```{r}
my_ethhet_CI <- function(x, conf.level) {
  mean <- mean(x, na.rm = TRUE)
  sd <- sd(x, na.rm = TRUE)
  n <- length(x)
  se <- sd/sqrt(n)
  z <- qnorm((1 + conf.level)/2)
  lower <- mean - z * se
  upper <- mean + z * se
  return(c(lower, upper))
  
}

my_ethhet_CI(angell_stata$ethhet, conf.level = .99)
```

17\) Write a function that you can `apply` to the Angell dataset to get 95% confidence intervals. The function should take one argument: a vector. Use if-else statements to output NA and avoid error messages if the column in the data frame is not numeric or logical.

```{r}
angell_CI <- function(x, conf.level) {
  if(!(is.numeric(x) || is.logical(x))) {
    return (NA)
  }
  mean <- mean(x, na.rm = TRUE)
  sd <- sd(x, na.rm = TRUE)
  n <- length(x)
  se <- sd/sqrt(n)
  z <- qnorm((1 + conf.level)/2)
  lower <- mean - z * se
  upper <- mean + z * se
  
  return(c(lower, upper))
}

angell_CI(angell_stata$ethhet, conf.level = .95)
angell_CI(angell_stata$city)
```
